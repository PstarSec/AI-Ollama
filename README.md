# Ollama 未授权访问【CNVD-2025-04094】验证脚本

## 1. **概述**

本脚本用于验证 Ollama API 可能存在的未授权访问漏洞（CNVD-2025-04094）。 漏洞原理基于目标系统暴露的 `/api/tags` 端点，允许未经身份验证的访问，从而获取 AI 模型的详细信息，包括模型名称、修改时间、大小、参数规模和量化级别。

## 2. **功能特点**

- **单个 URL 验证**：可测试指定的目标地址是否存在漏洞。
- **批量扫描**：支持从文件中读取多个 URL 并进行检测。
- **代理支持**：可通过 HTTP 或 SOCKS 代理执行请求，适用于内网或匿名测试环境。
- **超时设置**：支持用户自定义超时参数，提高测试灵活性。
- **格式化输出**：采用 `tabulate` 表格美化终端显示结果。
- **结果保存**：支持将扫描结果写入文件，便于后续分析。

## 3. **依赖环境**

我的是 Python 3.10.7写的，依赖以下库：

- `requests`（HTTP 请求库）
- `argparse`（命令行参数解析）
- `tabulate`（终端表格格式化）

安装依赖：

```bash
pip install requests tabulate colorama termcolor pyfiglet
```

## 4. **使用方法**

### **4.1 单个 URL 测试**

```bash
python Api-Ollama.py -u <目标 URL>
```

示例：

```bash
python Api-Ollama.py -u http://example.com
```

### **4.2 批量测试**

```bash
python Api-Ollama.py -ul urls.txt -o result.txt
```

其中 `urls.txt` 文件包含多个待测目标，每行一个 URL。

### **4.3 代理支持**

```bash
python Api-Ollama.py -u http://example.com -proxy socks5://127.0.0.1:1080
```

### **4.4 设置超时时间**

```bash
python Api-Ollama.py -u http://example.com -t 10
```

## 5. **检测逻辑**

1. 访问 `http://目标/api/tags` 端点。
2. 检查返回的 HTTP 状态码：
   - `200 OK` 且返回包含 `models` 字段，则认为存在漏洞。
   - 其他状态码（如 `403`、`404`）表示目标未受影响。
3. 若存在漏洞，解析并输出模型信息，包括：
   - **模型名称**
   - **修改时间（转换为北京时间）**
   - **文件大小（GB）**
   - **参数规模**
   - **量化级别**

## 6. **示例输出**

![](D:\桌面\博客文章\New笔记\笔记截图\2504fc7fc475093325d3a699895eb66-1741325416560-2.png)

**目标存在漏洞时：**

```
http://example.com
╒════════════╤═══════════════════╤════════╤═══════════╤═══════════╕
│ 模型       │ 修改时间           │ 大小   │ 参数大小  │ 量化级别   │
╞════════════╪═══════════════════╪════════╪═══════════╪═══════════╡
│ llama-2-7b │ 2025-03-07 14:30  │ 2.50GB │ 7B        │ int8      │
╘════════════╧═══════════════════╧════════╧═══════════╧═══════════╛
模型数量: 1
```

**目标无漏洞时：**

```
http://example.com
状态码: 404，不存在
......
```

## 7. **可能的错误及其原因**

本脚本在执行过程中可能遇到以下几种错误：

- **SSL 错误（SSL Error）**
  - 可能原因：目标服务器的 SSL 证书不受信任或证书过期。
  - 解决方案：尝试使用 `--proxy` 代理请求，或指定 `verify=False` 选项（不推荐）。
- **超时错误（Timeout Error）**
  - 可能原因：目标服务器响应过慢，或网络连接不稳定。
  - 解决方案：增加 `-t` 参数的超时时间，例如 `-t 15`。
- **连接错误（Connection Error）**
  - 可能原因：目标服务器拒绝连接，或者 URL 拼写错误。
  - 解决方案：检查目标 URL 是否可访问，或确认服务器是否开启。
- **请求异常（Request Exception）**
  - 可能原因：未知的网络异常，如 DNS 解析失败。
  - 解决方案：检查本地网络连接，或使用 `--proxy` 代理访问。

## 8. **注意事项**

- 本脚本仅用于 **安全研究** 和 **漏洞验证**，不得用于非法用途。
- 若目标服务器已修复漏洞，脚本可能不会返回有效结果。
- 对于部分误报情况，请手动确认。

## 9. **作者信息**

- **开发者**: PstarSec
- **项目地址**: [GitHub](https://github.com/PstarSec)
